#pragma config(Sensor, in2, sharp_front_top, sensorAnalog)
#pragma config(Sensor, in3, sharp_back_top, sensorAnalog)
#pragma config(Sensor, in7, sharp_bl, sensorAnalog)
#pragma config(Sensor, in8, sharp_bs, sensorAnalog)
#pragma config(Sensor, dgtl1, IR_BR, sensorDigitalIn)
#pragma config(Sensor, dgtl2, IR_BL, sensorDigitalIn)
#pragma config(Sensor, dgtl3, IR_FR, sensorDigitalIn)
#pragma config(Sensor, dgtl4, IR_FL, sensorDigitalIn)
#pragma config(Sensor, dgtl5, compass1, sensorDigitalIn) //
#pragma config(Sensor, dgtl6, compass2, sensorDigitalIn)
#pragma config(Sensor, dgtl7, compass3, sensorDigitalIn)
#pragma config(Sensor, dgtl8, compass4, sensorDigitalIn) // yellow of the compass goes here
#pragma config(Sensor, dgtl10, bumper_left, sensorDigitalIn)
#pragma config(Sensor, dgtl11, bumper_right, sensorDigitalIn)
#pragma config(Sensor, dgtl12, ball_limit, sensorDigitalIn)
#pragma config(Motor, port2, dispenser_driver, tmotorVex393_MC29, openLoop)
#pragma config(Motor, port7, conveyor_driver, tmotorVex393_MC29, openLoop)
#pragma config(Motor, port4, right_driver, tmotorVex393_MC29, openLoop)
#pragma config(Motor, port5, left_driver, tmotorVex393_MC29, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "movement.h"
#include "sensor.h"
#include "startup.c"
#include "searching_algorithm.c"
#include "ball_collection.c"
#include "ball_delivery.c"
#include "detect_boundary.c"
#include "detect_opponent.c"

void main_code(){
	if (ball_found == 1)
	// if (ball_found == 1 && ball_collected_limit == 1)
	{
		// ball collecion mechanism activate here
		writeDebugStreamLine("%s", "begin collection mechanism");
		go_to_ball();
		if (ball_collected_limit != 1)
		{
			// insert delivery mechanism
			writeDebugStreamLine("%s", "begin delivery");
			deliver_ball();
			// dispense();
			
			// shifted in house to deliver_ball
			// if (ball_delivered == 1){
			//	first_move();
			//}
		}
		else if (ball_collected_limit == 1)
			ball_found = 0; // sends it back into ball_found searching loop
	}
	else if (ball_found == 0)
	{
		if (SensorValue(ball_limit) == 0)
			ball_found = 1;
		sweeping_search();
	}
}

task main()
{

	// diagonistics
	//movement_test();
	//motor[conveyor_driver] = 100;
	//dispense();
	//while(ball_collected_limit != 0){
	//	conveyor_start(127);
	//	ball_collected_limit = SensorValue[ball_limit];
	//}

	deliver_ball();

	// threaded task that checks for sensor at all time
	//startTask(sensor_calibration);
	//startTask(detect_boundary);
	//startTask(detect_opponent);

	// inital movement where we move half the field b4 executing spin search
	//first_move();

	while (1)
	{
		//normal_sweep();
		//main_code();
	}
}
